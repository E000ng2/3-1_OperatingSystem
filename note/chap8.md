# 메모리 관리
## 1. 메모리 계층 구조와 메모리 관리 핵심
실행하고자 하는 프로그램 코드와 데이터 적재

- 메모리는 컴퓨터 시스템 여러 곳에 계층적으로 존재
  - CPU 레지스터 - CPU 캐시 - 메인 메모리 - 보조기억장치
  - 빠른 메모리일수록 고가
- 메모리 계층화의 목적
  - 빠른 프로그램 실행을 위해
  
  ```
  Q : 작은 캐시에 당장 실행할 프로그램 코드와 데이터를 일부분만 두는데도 효과적일까?
  
  A : 코트나 데이터, 자원들이 아주 짧은 시간 내에 다시 사용되는 특성이 있어 일부만 빠르게 접근해도 큰 효과를 볼 수 있다. ( 시간적 지역성 )
  ```
- 운영체재에 의해 메모리 관리가 필요한 이유
  - 공유 자원
  - 보호의 대상
  - 용량 한계 극복 필요
  - 효율성 증대

## 2. 메모리 주소
메모리는 오직 주소로만 접근

- 주소의 종류 
  - 물리 주소(physical address)
  - 논리/가상 주소(logical address)

- MMU(Memory Management Unit)
  - 논리 주소를 물리 주소로 바꾸는 하드웨어 장치

## 3. 메모리 할당(memory allocation)
- 운영체제가 새 프로세스를 실행시키거나 실행 중인 프로세스가 메모리를 필요로 할 때 물리 메모리 할당
- 연속 메모리 할당 : 프로세스별로 연속된 한 덩어리의 메모리 할당
  - 고정 크기 할당 : 메모리를 고정 크기의 파티션으로 나누고 프로세스당 하나의 파티션 할당 / 내부 단편화(internal fragmentation) 
  - 가변 크기 할당 : 메모리를 가변 크기의 파티션으로 나누고 프로세스 당 하나의 파티션 할당 / 외부 단편화(external fragmentation)
- 분할 메모리 할당 : 프로세스에게 여러 덩어리의 메모리 할당
  - 고정크기 할당 : 고정 크기의 덩어리 메모리를 여러개 분산 할당 / 페이징 기법
  - 가변 크기 할당 : 가변 크기의 덩어리 메모리를 여러개 분산 할당 / 세그멘테이션 기법
  
## 4. 연속 메모리 할당

프로세스를 1개의 연속된 공간에 배치

- 고정 크기 할당 (fixed size partition)
  - 수용가능 프로세스 수는 n개로 고정
  
- 가변 크기(variable size partition)
  - 수용가능 프로세스 수는 가변적
  
- 단편화(fragmentation)
    
     프로세스에게 할당할 수 없는 조각 메모리들이 생기는 현상. hole

     - 내부 단편화(internal fragmentation)
        
        할당된 메모리 내부에 사용할 수 없는 홀이 생기는 현상

    - 외부 단편화(external fregmentation)
        
        할당된 메모리들 사이에 사용할 수 없느 홀이 생기는 현상

- 연속 메모리 할당 구현
  - 하드웨어 지원
    
    CPU레지스터(base 레지스터 , limit 레지스터, 주소 레지스터)
    
    주소 변환 하드웨어(MMU)

  - 운영체제 지원
    
    '물리 메모리의 시작 주소와 크기 정보 저장' 관리

    비어있는 메모리 영역 관리

- 연속 메모리 할당의 장단점
  - 장점 
    
    MMU시간이 짧음

    운영체제가 관리할 정보량 적음

  - 단점
    
    메모리 할당 유연성 떨어짐

- 홀 선택 알고리즘 / 동적 메모리 할당
  - first-fit(최초 적합) : 처음으로 만나는 홀 선택
  - best-fit(최적 적합) : 가장 작은 홀 선택
  - worst-fit(최악 적합) : 가장 큰 홀 선택

## 5. 세그먼테이션 메모리 관리
- 세그먼테이션(segmentation)
    
    프로그램을 구성하는 논리적 단위, 세그먼트마다 크기 다름
        
    - 코드 세그먼트
    - 데이터 세그먼트
    - 스택 세그먼트
    - 힙 세그먼트
  
- 세그먼테이션 기법

    프로세스를 논리 세그먼트들로 나누고, 각 논리 세그먼트를 물리 메모리에 할당하는 메모리 관리 기법

    - 세그먼테이션 테이블을 통해 맵핑
    - 컴파일러와 킹커에 의해 논리 세그먼트로 나누어짐
    - 외부 단편화 발생

- 세그먼데이션의 구현
  - 하드웨어 지원
    
    논리 주소 : [세그먼트 번호, 옵셋]

    CPU : 세그먼트 테이블의 시작 주소를 가리키는 레지스터 필요

    MMU 장치 : 주소변환, 메모리 보호, 메모리 할당

    세그먼트 테이블 : 메모리 저장, 시작물리 주소 세그먼트 크기 정보

  - 운영체제 지원

    세그먼트의 동적 할당/ 반환 및 세그먼트 테이블 관리 기능 구현

  - 컴파일러, 링커, 로더 지원

**외부 단편화 발생/ 내부 단편화 없음**



